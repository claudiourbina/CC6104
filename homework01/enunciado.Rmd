---
title: "Tarea 1"
output:
  html_document:
    df_print: paged
---

![](banner.png)

<center> <h1>Tarea 1: Foundations</h1> </center>
<center><strong>CC6104: Statistical Thinking</strong></center>
#### **Integrantes :** 

- Alumno 1
- Alumno 2

#### **Cuerpo Docente:**

- Profesor: Felipe Bravo M.
- Auxiliares: Mart칤n Paredes, Mar칤a Jos칠 Zambrano
- Ayudantes: Nicolas Cabello, Kevin Iturra,  Mariana V치squez

### **칈ndice:**

1. [Objetivo](#id1)
2. [Instrucciones](#id2)
3. [Referencias](#id3)
4. [Segunda Parte: Elaboraci칩n de C칩digo](#id4)

### **Objetivo**<a name="id1"></a>

Bienvenid@s a la primera tarea del curso Statistical Thinking. Esta tarea tiene como objetivo evaluar los contenidos te칩ricos de la primera parte del curso, los cuales se enfocan principalmente en an치lisis exploratorio de datos y conceptos introductorios de probabilidades. Si a칰n no han visto las clases, se recomienda visitar los enlaces de las referencias.

La tarea consta de ejercicios pr치cticos con el f칤n de introducirlos a la programaci칩n en R enfocada en el an치lisis estad칤stico de datos. 

### **Instrucciones:**<a name="id2"></a>

- La tarea se realiza en grupos de **m치ximo 2 personas**. Pero no existe problema si usted desea hacerla de forma individual.
- La entrega es a trav칠s de u-cursos a m치s tardar el d칤a estipulado en la misma plataforma. A las tareas atrasadas se les descontar치 un punto por d칤a.
- El formato de entrega es este mismo **Rmarkdown** y un **html** con la tarea desarrollada. Por favor compruebe que todas las celdas han sido ejecutadas en el archivo html.
- Al momento de la revisi칩n tu c칩digo ser치 ejecutado. Por favor verifica que tu entrega no tenga errores de compilaci칩n.
- No ser치n revisadas tareas desarrolladas en Python.
- Est치 **PROHIBIDO** la copia o compartir las respuestas entre integrantes de diferentes grupos.
- Pueden realizar consultas de la tarea a trav칠s de U-cursos y/o del canal de Discord del curso. 


### **Referencias:**<a name="id3"></a>

Slides de las clases:

- [Introduction to Statistical Thinking](https://github.com/dccuchile/CC6104/blob/master/slides/1_1_ST-intro.pdf)
- [Introduction to R](https://github.com/dccuchile/CC6104/blob/master/slides/1_2_ST-R.pdf)
- [Descriptive Statistics](https://github.com/dccuchile/CC6104/blob/master/slides/1_3_ST-explore.pdf)
- [Probability](https://github.com/dccuchile/CC6104/blob/master/slides/1_4_ST-prob.pdf)

Videos de las clases:

- Introduction to Statistical Thinking: [video1](https://youtu.be/X4SqJu6lExM) [video2](https://youtu.be/YbiQU5TTBX4)
- Introduction to R: [video1](https://youtu.be/MbeLD3hWWVo) [video2](https://youtu.be/9W_eWCy86F4) [video3](https://youtu.be/QvFXSw2-1r4) [video4](https://youtu.be/y4JY7klrbfQ)
- Descriptive Statistics: [video1](https://youtu.be/kWNskZ8_98o) [video2](https://youtu.be/_FJ8x9M4b1w) [video3](https://youtu.be/m7VBNZ2mYWI) [video4](https://youtu.be/ylGMJ_aSQk0)
- Probability: [video1](https://youtu.be/R9AVYV73m1M) [video2](https://youtu.be/zubh1jbRiKE) [video3](https://youtu.be/uiwToagp0z4) [video4](https://youtu.be/RlhN3t_VIyw) [video5](https://youtu.be/4kV1dBaeWVc) [video6](https://youtu.be/MGyXc70JdSk)



En la siguiente secci칩n deber치 resolver cada uno de los experimentos computacionales a trav칠s de la programaci칩n en R. Para esto se le aconseja que cree funciones en R, ya que le facilitar치 la ejecuci칩n de gran parte de lo solicitado.

## Pregunta 1: Visualizaci칩n de Datos

Para esta pregunta usted deber치 trabajar en base al conjunto de datos `hearth_database.csv`, el cual esta compuesto por las siguientes variables:

- target: Se침ala si el paciente tuvo un infarto.
- sex: Sexo de los sujetos de prueba.
- fbs: Az칰car en la sangre con ayunas. Esta variable se침ala solo si se encuentra <=120 o >120.
- exang: Angina de pecho inducida por el ejercicio.
- cp: Tipo de dolor de pecho.
- restecg: Resultados electrocardiogr치ficos en reposo.
- slope: Pendiente del segmento ST m치ximo de ejercicio.
- ca: N칰mero de buques principales.
- thal: Thalassemia.
- age: Edad en a침os.
- trestbps: Presi칩n arterial en reposo.
- chol: colesterol s칠rico en mg/dl.
- thalach: Frecuencia card칤aca m치xima alcanzada.
- oldpeak: Depresi칩n del ST inducida por el ejercicio en relaci칩n con el reposo.

En base al dataset propuesto realice un an치lisis exploratorio de los datos (EDA). Para su an치lisis enfoquen el desarrollo en las siguientes tareas:

```{R}
library(ggplot2)
hearth.data <- read.csv("hearth_database.csv", fileEncoding = "Latin1")
```

- [x] Obtenga la media, mediana, quintiles y valores m치ximos desde los datos que componen el dataset.

```{R}
summary(hearth.data)
```

- [x] Obtenga la Matriz de correlaci칩n de Pearson y visualice la relaci칩n entre las variables num칠ricas.

```{R}
numeric.cols <- unlist(lapply(hearth.data, is.numeric))
cor(hearth.data[, numeric.cols])
```
```{R}
pairs(hearth.data[, numeric.cols])
```

- [x] Visualice los boxplot para las variables num칠ricas.

```{R}
boxplot(hearth.data[, numeric.cols], main='Numerical Variables')
```

- [x] Visualice a trav칠s de un histograma como distribuyen las variables respecto a los TARGET.

```{R}
for (i in 1:length(numeric.cols)) {
  if (numeric.cols[i]) {
    gg <- ggplot(hearth.data, aes_string(x = names(hearth.data)[i])) +
      geom_histogram(fill = "blue", color = "black") +
      labs(title = paste("Histogram of", names(hearth.data)[i], "by Label"), x = names(hearth.data)[i], y = "Frequency") +
      facet_grid(. ~ target) + 
      theme_minimal()
    print(gg)
  }
}
```

---

## Pregunta 2: Teorema Central del Limite

Pruebe el teorema central del limite aplicando un muestreo de la media en las distribuciones Gamma, Normal y una a su elecci칩n. Grafique los resultados obtenidos y se침ale aproximadamente el numero de muestreos necesarios para obtener el resultado esperado, pruebe esto con las siguientes cantidades de muestreo $\{10,100,1000,5000\}$. 쮼l efecto ocurre con el mismo n칰mero de muestreo para todas las distribuciones?.

**Respuesta**

```{R}
n <- 100
samples <- c(10, 100, 1000, 5000)
set.seed(250317)
```

### Gamma

```{r eval=FALSE}
x.range <- c(5, 15)
for (sample in samples) {
  gamma.mean <- replicate(sample, mean(rgamma(n, 10)))
  hist(gamma.mean, main = paste("Histograma de medias ( n =", sample, ")"), xlab = "Media de la muestra", xlim = x.range)
}
```

### Normal

```{r eval=FALSE}
x.range <- c(5, 15)
for (sample in samples) {
  norm.mean <- replicate(sample, mean(rnorm(n, 10, 6)))
  hist(norm.mean, main = paste("Histograma de medias ( n =", sample, ")"), xlab = "Media de la muestra", xlim = x.range)
}
```


```{R}
x.range <- c(0.45, 0.55)
for (sample in samples) {
  exp.mean <- replicate(sample, mean(rbeta(n, 10, 10)))
  hist(exp.mean, main = paste("Histograma de medias ( n =", sample, ")"), xlab = "Media de la muestra", xlim=x.range)
}
```

---

## Pregunta 3: Ley de los Grandes Numeros.

#### Lanzamiento de monedas
Realice el experimento de lanzar una moneda cargada 1000 veces y observe el comportamiento que tiene la probabilidad de salir cara. Para realizar el experimento considere que la moneda tiene una probabilidad de $5/8$ de salir cara. Grafique el experimento para las secuencias de intentos que van desde 1 a 1000, se침alando el valor en que converge la probabilidad de salir cara.

**Respuesta**

```{r eval=TRUE}
# Simular lanzamientos
n = 1000
coin <- c(1, 0) # 1: head, 0: tail
coin.probs <- c(5/8, 3/8)
flips <- 0

for (lanzamientos in 1:1000) {
  flips[lanzamientos] <- sum(replicate(lanzamientos, sample(x=coin, size=1, prob=coin.probs)))/n
}

# Gr치fico de la convergencia
plot(1:1000, flips, type = "s", col = "red", xlab = "coin tosses", ylab = "probability of head", main="Probability of Head vs Coin Tosses")
```
Claramente, se puede apreciar que la probabilidad de salir cara converge efectivamente a 5/8 = 0.625 a medida que los lanzamientos aumentan.

#### El problema de Monty Hall 

Remont치ndonos en la televisi칩n del a침o 1963, en USA exist칤a un programa de concursos donde los participantes deb칤an escoger entre 3 puertas para ganar un premio so침ado. El problema del concurso era que solo detr치s de 1 puerta estaba el premio mayor, mientras que detr치s de las otras dos hab칤an cabras como "premio". 

Una de las particularidades de este concurso, es que cuando el participante escog칤a una puerta, el animador del show abr칤a una de las puertas que no fue escogida por el participante (Obviamente la puerta abierta por el animador no conten칤a el premio). Tras abrir la puerta, el animador consultaba al participante si su elecci칩n era definitiva, o si deseaba cambiar la puerta escogida por la otra puerta cerrada. Un v칤deo que puede ayudar a comprender mejor este problema en el siguiente [link](https://www.youtube.com/watch?v=rSa_uiKncEI).

Imagine que usted es participante del concurso y desea calcular la probabilidad de ganar el gran premio **si cambia de puerta** en el momento que el animador se lo ofrece. Utilizando listas/arrays/vectores simule las puertas del concurso, dejando aleatoriamente el premio en alguna posici칩n del array. Hecho esto, genere un numero de forma aleatoria para escoger una de las puerta (posiciones de la estructura), para luego ver si cambiando de posici칩n tendr치 mayores posibilidades de ganar el premio. Genere N veces el experimento y grafique cada una de las iteraciones, tal como se hizo en el ejercicio de las monedas.

<p align="center">
  <img src="https://brilliant-staff-media.s3-us-west-2.amazonaws.com/tiffany-wang/gWotbuEdYC.png" width="350">
</p>


**Respuesta:**

```{r eval=FALSE}
# Creamos una funci칩n que simule el juego
montyhall <- function(cambiar.puerta=TRUE){
  puertas <- sample(1:3,3) # la puerta con el valor 3 es la ganadora
  eleccion <- sample(1:3,1) # se elige la puerta 1, 2, 3 al azar
  abierta <- sample(setdiff(1:2,eleccion),1) # se abre una puerta no ganadora que no selecciono el participante
  if(cambiar.puerta){
    eleccion <<- setdiff(setdiff(1:3,eleccion), abierta) # se cambia a la que no se abrio y no tenia ya seleccionada
  }
  return(puertas[eleccion]==3)
}

attempts <- 0

# Funci칩n que simula N juegos
play.montyhall <- function(n=10, cambiar.puerta=TRUE){
  return(sum(replicate(n, montyhall(cambiar.puerta=cambiar.puerta))/n))
}

for(attempt in 1:1000){
  attempts[attempt] <- play.montyhall(n=attempt)
}

plot(1:1000, attempts, type = "s", col = "red", xlab = "number of times the door was changed", ylab = "probability of win", main="Probability of win when the door is changed")
```
Como se puede apreciar, la probabilidad de ganar al cambiar de puerta despues de conocer una no ganadora converge a 30% (approx). Es mejor no cambiar.

---

## Pregunta 4: 쯀ndependencia?
Ustedes disponen de los dados D1 y D2, los cuales no est치n cargados y son utilizados para comprobar que $\mathbb{P}(AB)=\mathbb{P}(A)\mathbb{P}(B)$ cuando el evento A es independiente del B. Para estudiar la independencia considere que los eventos A y B se definen de la siguiente manera; sea A el evento dado por los valores obtenidos en el lanzamiento del dado D1, este est치 compuesto por $A=\{D1=1,D1=2,D1=6\}$. Por otro lado, el evento B viene dado por los valores obtenidos con el dado D2, el que est치 conformado por $B=\{D2=1,D2=2,D2=3,D2=4\}$. Con esto, tendremos un $\mathbb{P}(A)=1/2$, $\mathbb{P}(洧냣)=2/3$ y $\mathbb{P}(AB)=1/3$. Compruebe de forma gr치fica que al realizar 1000 lanzamientos (u otro valor grande que usted desea probar) se visualiza que $\mathbb{P}(AB)=\mathbb{P}(A)\mathbb{P}(B)$. 

Hecho lo anterior, compruebe el comportamiento de un segundo grupo de eventos, dados por el lanzamiento de solo el dado D1. Donde, los eventos para D1 quedan definidos como: $A =\{D1=1,D1=2,D1=6\}$ y $B=\{D1=1,D1=2,D1=3\}$. 쯉e observa independencia en este experimento?.

Se le aconseja que para simular los lanzamientos de dados utilice la funci칩n `sample()` para generar valores aleatorios entre 1 y 6. Compruebe los n칰meros generados por la funci칩n con los casos favorables de cada uno de los eventos a ser estudiados.

**Respuesta:**

```{r eval=FALSE}
# Primer grupo de eventos
N_lan = 1000 # Numero de lanzamientos
  
L_A =  # Lanzamientos favorables A = c(1, 2, 6)
L_B =  # Lanzamientos favorables B = c(1, 2, 3, 4)
L_AB = # Lanzamientos favorables AB = c(1, 2)
```

```{r eval=FALSE}
# Segundo grupo de eventos
N_lan = 1000 # Numero de lanzamientos
  
L_A =  # Lanzamientos favorables A = c(1, 2, 6)
L_B =  # Lanzamientos favorables B = c(1, 2, 3)
L_AB = # Lanzamientos favorables AB = c(1, 2)
```

---
## Pregunta 5: La Ruina del Jugador
Un amigo lud칩pata suyo le comenta que el truco de jugar en el casino esta en no parar de apostar y apostando lo m칤nimo posible. Ya que as칤, tienes mas probabilidades de ganar el gran pozo que acumula el juego. Usted sabiendo la condici칩n de su amigo, decide no creer en su conjetura y decide probar esto a trav칠s de un experimento.

Para realizar el experimento usted decide asumir las siguientes declaraciones, bajo sus observaciones:

- La probabilidad de ganar en un juego del casino es $8/19$
- Sabe que su amigo *solo* posee siempre fondos en el rango de 0 a 200 dolares.
- Las apuestas como m칤nimo deben ser igual a 5 dolares.
- El monto de las apuestas no cambia y son siempre igual a la primera. Por ejemplo, si su amigo apuesta 50 dolares, todos los pr칩ximos juegos apuesta 50 hasta que se acaba su dinero.
- Usted pierde cuando se le acaban los fondos.

En el primer experimento deber치 obtener la evoluci칩n de los fondos hasta que el jugador se queda sin fondos para jugar. Puede ser 칰til seguir la l칩gica de una moneda cargada para realizar esto. Pruebe esto con una apuesta igual a 5, 25 y 50 graficando los resultados. Comente los resultados obtenidos.

Para la segunda parte de este experimento, con las funciones ya creadas, proyecte 5000 apuestas y obtenga la probabilidad a la que converge el experimento empezando con una apuesta de: 5, 25 y 50. Para este experimento considerar como 칠xito (1) cuando su funci칩n ruina supera los 200 y considere lo contrario cuando su funci칩n perdida es menor o igual a 0.


**Respuesta**

```{r eval=FALSE}
# Funci칩n para obtener el desarrollo de las apuestas


ruina <- function(fondos = 100, apuesta = 5){
  game <- c(1, -1) # 1: win, -1: lose
  game.probs <- c(8/19, 11/19)
  fondos.hist <- c(fondos)
  i <- 2
  while (0<fondos & fondos<200) {
    fondos <- fondos + apuesta*sample(x=game, size=1, prob=game.probs)
    fondos.hist[i] <- fondos
    i <- i + 1
  }
  return(fondos.hist) # Devuelve un vector con el desarrollo de los fondos
}

plot(ruina(), type="l", col="blue", xlab="N춿 de juegos", ylab="Fondos", main="Evoluci칩n de los fondos (apuesta = 5)")
plot(ruina(apuesta = 25), type="l", col="blue", xlab="N춿 de juegos", ylab="Fondos", main="Evoluci칩n de los fondos (apuesta = 25)")
plot(ruina(apuesta = 50), type="l", col="blue", xlab="N춿 de juegos", ylab="Fondos", main="Evoluci칩n de los fondos (apuesta = 50)")
```



&nbsp;
<hr />
<p style="text-align: center;">A work by <a href="https://github.com/dccuchile/CC6104">CC6104</a></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css">

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://github.com/dccuchile/CC6104"><i class="fab fa-github" style='font-size:30px'></i></a>
</p>

&nbsp;